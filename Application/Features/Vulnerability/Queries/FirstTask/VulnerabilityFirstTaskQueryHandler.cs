using Application.Interfaces;
using Domain;
using MediatR;

namespace Application.Features.Vulnerability.Queries.FirstTask;

internal class VulnerabilityFirstTaskQueryHandler : IRequestHandler<VulnerabilityFirstTaskQuery, byte[]>
{
    private readonly IParser _parser;
    private readonly IExcelChartExporter _excelChartExporter;

    public VulnerabilityFirstTaskQueryHandler(IParser parser, IExcelChartExporter excelChartExporter)
    {
        _parser = parser ?? throw new ArgumentNullException(nameof(parser));
        _excelChartExporter = excelChartExporter ?? throw new ArgumentNullException(nameof(excelChartExporter));
    }

    public Task<byte[]> Handle(VulnerabilityFirstTaskQuery request, CancellationToken cancellationToken)
    {
        var result = _parser.MapFromByte(request.ByteArray);
        return Task.FromResult(_excelChartExporter.GenerateExcelWithChartsFirstTask(result));
    }
}
