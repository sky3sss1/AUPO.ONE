using Application.Interfaces;
using MediatR;

namespace Application.Features.Vulnerability.Queries.SecondTask;

internal class VulnerabilitySecondTaskQueryHandler : IRequestHandler<VulnerabilitySecondTaskQuery, byte[]>
{
    private readonly IParser _parser;
    private readonly IExcelChartExporter _excelChartExporter;

    public VulnerabilitySecondTaskQueryHandler(IParser parser, IExcelChartExporter excelChartExporter)
    {
        _parser = parser ?? throw new ArgumentNullException(nameof(parser));
        _excelChartExporter = excelChartExporter ?? throw new ArgumentNullException(nameof(excelChartExporter));
    }

    public Task<byte[]> Handle(VulnerabilitySecondTaskQuery request, CancellationToken cancellationToken)
    {
        var result = _parser.MapFromByte(request.ByteArray);
        return Task.FromResult(_excelChartExporter.GenerateExcelWithChartsSecondTask(result));
    }
}
